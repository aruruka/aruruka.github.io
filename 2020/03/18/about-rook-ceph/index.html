<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="About-Rook-Ceph, Cloudera Kubernetes k8s DevOps 少年G ShounenG aruruka">
    <meta name="description" content="In Kubernetes, StatefulSet is designed to address the topological and storage state of the application. And we usually need to use storage services to provide to StatefulSet to use. Ceph is a popular open source distributed storage solution. Rook can help us deploy and use Ceph in k8s.">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>About-Rook-Ceph | 少年G的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">少年G的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">少年G的博客</div>
        <div class="logo-desc">
            
            专注于DevOps
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/aruruka" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/aruruka" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/18.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">About-Rook-Ceph</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Ceph/">
                                <span class="chip bg-color">Ceph</span>
                            </a>
                        
                            <a href="/tags/Kubernetes/">
                                <span class="chip bg-color">Kubernetes</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Kubernetes/" class="post-category">
                                Kubernetes
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-03-18
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-03-19
                </div>
                

                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Rook-Ceph"><a href="#Rook-Ceph" class="headerlink" title="Rook Ceph"></a>Rook Ceph</h1><h2 id="Why-StatefulSets"><a href="#Why-StatefulSets" class="headerlink" title="Why StatefulSets"></a>Why StatefulSets</h2><p>So we all know there are several kinds of workloads controller in Kubernetes including <code>Deployments</code>, <code>StatufulSets</code>, <code>DaemonSet</code> – these three kinds are mostly common-used.<a href="https://kubernetes.io/docs/concepts/" target="_blank" rel="noopener">^1</a></p>
<p>When we deploy stateful App in Kubernetes, we have to concern about that where is the storage. In the very basic way, it is located within the container, which means the when the Pod is gone, the storage is gone.</p>
<p>Take a glance at the picture below.</p>
<p><img src="Stateful_Apps_on_Kubernetes.png" alt="Stateful Apps on Kubernetes.png"></p>
<p>A StatefulSets is for us to deploy Apps which have persistence requirement to storage, which typically is like most of the cluster type Apps(e.g. database, cache, registry in microservices).</p>
<p><img src="Data_To_Container_Host_Mapping.png" alt="Data To Container Host Mapping"></p>
<p>The picture above explained why persistent storage is needed.</p>
<h2 id="About-Kubernetes-and-Ceph"><a href="#About-Kubernetes-and-Ceph" class="headerlink" title="About Kubernetes and Ceph"></a>About Kubernetes and Ceph</h2><h3 id="Ceph"><a href="#Ceph" class="headerlink" title="Ceph"></a>Ceph</h3><p>Ceph is an open-source distributed object, block, and file storage.<a href="https://www.stratoscale.com/blog/storage/introduction-to-ceph/" target="_blank" rel="noopener">^2</a></p>
<p>Today’s workloads and infrastructure require different data access methods (object, block, file) and Ceph supports all of them.<br>It is designed to be scalable and to have no single point of failure. It is open source software that runs on commodity, readily-available, hardware.</p>
<h3 id="Compatibility-of-Kubernetes-with-Ceph"><a href="#Compatibility-of-Kubernetes-with-Ceph" class="headerlink" title="Compatibility of Kubernetes with Ceph"></a>Compatibility of Kubernetes with Ceph</h3><p>Kubernetes supports CephFS and CephRBD as StorageClass provioner.<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#provisioner" target="_blank" rel="noopener">^3</a><br>While using CephFS as backend of PV(PersistentVolume), it is needed to have external provisioner installed.</p>
<h1 id="Use-Rook-to-Install-Ceph"><a href="#Use-Rook-to-Install-Ceph" class="headerlink" title="Use Rook to Install Ceph"></a>Use Rook to Install Ceph</h1><h3 id="About-Operator"><a href="#About-Operator" class="headerlink" title="About Operator"></a>About Operator</h3><p>While running complicated Apps, one of the best practice is to run an Operator.<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" target="_blank" rel="noopener">^5</a><br>In short, an Operator is a combination of <code>Custom Resources</code><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" target="_blank" rel="noopener">^7</a> and <code>Controller</code><a href="https://kubernetes.io/docs/concepts/architecture/controller/" target="_blank" rel="noopener">^8</a>.<br>Many middleware cloud provider has maintaining there own official <code>Operator</code> for Kubernetes, such as <a href="https://github.com/elastic/cloud-on-k8s" target="_blank" rel="noopener">Elastisearch</a>, <a href="https://github.com/mongodb/mongodb-enterprise-kubernetes" target="_blank" rel="noopener">MongoDB</a>, <a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener">TiDB</a>.<br>If you want to deploy a new stateful App in Kubernetes, start from looking for if an available <code>Operator</code> exists. Some useful collection links as below.</p>
<ul>
<li><a href="https://ramitsurana.github.io/awesome-kubernetes/#operators" target="_blank" rel="noopener">awesome-kubernetes</a></li>
<li><a href="https://github.com/operator-framework/awesome-operators" target="_blank" rel="noopener">awesome-operators</a></li>
<li><a href="https://kubedex.com/operators/" target="_blank" rel="noopener">kubedex - Operators</a></li>
</ul>
<h2 id="About-Rook"><a href="#About-Rook" class="headerlink" title="About Rook"></a>About Rook</h2><p>Rook is an open source cloud-native storage orchestrator for Kubernetes, providing the platform, framework, and support for a diverse set of storage solutions to natively integrate with cloud-native environments.<a href="https://github.com/rook/rook/blob/master/README.md#what-is-rook" target="_blank" rel="noopener">^4</a></p>
<p>At this stage, support for Ceph on Rook is already stable,<a href="https://github.com/rook/rook/blob/master/README.md#project-status" target="_blank" rel="noopener">^6</a> we can use it to manage Ceph cluster deployed in Kubernetes. And use it to provide persistent volume to afford StatefulSets Apps.</p>
<h2 id="Install-steps-of-Rook"><a href="#Install-steps-of-Rook" class="headerlink" title="Install steps of Rook"></a>Install steps of Rook</h2><p>At the moment the latest release version of Rook is “release-1.2”.<br>Go to the Githup repository of Rook, find <a href="https://github.com/rook/rook/tree/release-1.2/cluster/examples/kubernetes/ceph" target="_blank" rel="noopener">ceph’s manifest example</a>.</p>
<p>I have put the configured files in our repository, link: <a href="https://github.com/aruruka/laboratory/tree/master/k8s/manifest/apps/rook/ceph" target="_blank" rel="noopener">rook manifest</a></p>
<p><img src="rook_manifest.png" alt="Rook Manifest"></p>
<h3 id="Deploy-Rook-Operator"><a href="#Deploy-Rook-Operator" class="headerlink" title="Deploy Rook Operator"></a>Deploy Rook Operator</h3><p>Apply the manifest.</p>
<pre><code>$ kubectl apply -f common.yaml
$ kubectl apply -f operator.yaml</code></pre><p>Then watch status of Pod.</p>
<pre><code>$ kubectl get pod -n rook-ceph</code></pre><h3 id="Create-Ceph-cluster"><a href="#Create-Ceph-cluster" class="headerlink" title="Create Ceph cluster"></a>Create Ceph cluster</h3><p>Now Rook Operator is running so we can continue to create Ceph cluster.</p>
<h4 id="Some-customized-configuration"><a href="#Some-customized-configuration" class="headerlink" title="Some customized configuration"></a>Some customized configuration</h4><p>Here are some places I’ve configured in <code>cluster.yaml</code>.</p>
<ol>
<li><p><code>.spec.placement</code></p>
<p>To use <code>Affinity</code> and <code>Toleration</code> to specify dedicated Nodes for deploying Ceph Cluster.</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">placement</span><span class="token punctuation">:</span>
    <span class="token key atrule">all</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
        <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
          <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> role
              <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
              <span class="token key atrule">values</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> storage<span class="token punctuation">-</span>node
      <span class="token key atrule">podAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">podAntiAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> storage<span class="token punctuation">-</span>node
        <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Also, we need to add some Nodes into Kubernetes cluster, and <code>label</code> and <code>taint</code> them right.</p>
<pre><code>$ kubectl get nodes -l role=storage-node
NAME                   STATUS   ROLES    AGE    VERSION
datateam-rookceph-01   Ready    &lt;none&gt;   7d5h   v1.17.1
datateam-rookceph-02   Ready    &lt;none&gt;   7d5h   v1.17.1
datateam-rookceph-03   Ready    &lt;none&gt;   7d5h   v1.17.1</code></pre><pre><code>$ kubectl get nodes -o go-template-file=&quot;${HOME}/go-template/kubectl_node_taint.tmpl&quot; | sed -rn &#39;1p;/rook/Ip&#39;
Node                                               Taint
datateam-rookceph-01    storage-node=&lt;no value&gt;:NoExecute
datateam-rookceph-02    storage-node=&lt;no value&gt;:NoExecute
datateam-rookceph-03    storage-node=&lt;no value&gt;:NoExecute</code></pre></li>
<li><p><code>.spec.dataDirHostPath</code></p>
<p>This is the host dir for Ceph cluster storage, make sure every Node which is used to deploy Ceph has this directory.</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">dataDirHostPath</span><span class="token punctuation">:</span> /data/rook_data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>.spec.storage.directories</code></p>
<p>This is the path for Ceph OSD storage.</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">directories</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/rook_data/filestore<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h4 id="Sample-output"><a href="#Sample-output" class="headerlink" title="Sample output"></a>Sample output</h4><pre><code>$ kubectl apply -f cluster.yaml</code></pre><p>Sample output after deploying Ceph cluster.</p>
<pre><code>$ kubectl get pods -n rook-ceph
NAME                                                             READY   STATUS      RESTARTS   AGE
csi-cephfsplugin-9bcdd                                           3/3     Running     0          6d19h
csi-cephfsplugin-jgkjx                                           3/3     Running     0          6d19h
csi-cephfsplugin-provisioner-7c75f6bf94-k4h4c                    5/5     Running     0          6d19h
csi-cephfsplugin-provisioner-7c75f6bf94-s9p5m                    5/5     Running     0          6d19h
csi-rbdplugin-ccw6t                                              3/3     Running     0          6d19h
csi-rbdplugin-jz5kh                                              3/3     Running     0          6d19h
csi-rbdplugin-provisioner-7954c9db75-jvjh7                       6/6     Running     0          6d19h
csi-rbdplugin-provisioner-7954c9db75-wv56c                       6/6     Running     0          6d19h
rook-ceph-crashcollector-datateam-rookceph-01-5c489fbc7b-246vr   1/1     Running     0          7d
rook-ceph-crashcollector-datateam-rookceph-02-7b459d4f69-t7wdq   1/1     Running     0          7d
rook-ceph-crashcollector-datateam-rookceph-03-5d7578fdd6-lv9br   1/1     Running     0          7d
rook-ceph-mgr-a-5d4765dfb-p4tfr                                  1/1     Running     0          7d
rook-ceph-mon-a-6864d58cc7-8qtst                                 1/1     Running     0          7d
rook-ceph-mon-b-65fbf9b96c-v9llx                                 1/1     Running     0          7d
rook-ceph-mon-c-54984d88b6-kxxc9                                 1/1     Running     0          7d
rook-ceph-operator-648d574f5c-bw6cz                              1/1     Running     0          6d19h
rook-ceph-osd-0-6f966cc46b-n2trl                                 1/1     Running     0          7d
rook-ceph-osd-1-757cc69bc9-nd2ml                                 1/1     Running     0          7d
rook-ceph-osd-2-57b88cd98f-bvkw4                                 1/1     Running     0          7d
rook-ceph-osd-prepare-datateam-rookceph-01-tcfwp                 0/1     Completed   0          6d19h
rook-ceph-osd-prepare-datateam-rookceph-02-mqg4w                 0/1     Completed   0          6d19h
rook-ceph-osd-prepare-datateam-rookceph-03-bchr5                 0/1     Completed   0          6d19h
rook-ceph-tools-6cb8fcc6f9-42p69                                 1/1     Running     0          6d19h
rook-discover-42h6t                                              1/1     Running     0          7d5h
rook-discover-tghgv                                              1/1     Running     0          7d5h</code></pre><h3 id="Use-Rook-toolbox-to-verify-Ceph-cluster-status"><a href="#Use-Rook-toolbox-to-verify-Ceph-cluster-status" class="headerlink" title="Use Rook toolbox to verify Ceph cluster status"></a>Use Rook toolbox to verify Ceph cluster status</h3><p>To verify status of Ceph cluster, we could use the Rook toolbox.</p>
<p>P.S. The image of Rook Ceph is based on CentOS, so we can use yum to install tools on-demand and rebuild the image.</p>
<pre><code>kubectl apply -f toolbox.yaml</code></pre><p>And we can simply define a script to alias the <a href="https://github.com/aruruka/laboratory/blob/master/k8s/hack/ceph_profile_d.sh" target="_blank" rel="noopener"><code>ceph</code></a> command.</p>
<pre><code># /etc/profile.d/ceph_profile_d.sh

alias ceph=&#39;kubectl -n rook-ceph exec -i $(kubectl -n rook-ceph get pod -l &quot;app=rook-ceph-tools&quot; -o jsonpath=&#39;{.items[0].metadata.name}&#39;) -- ceph&#39;
alias rados=&#39;kubectl -n rook-ceph exec -i $(kubectl -n rook-ceph get pod -l &quot;app=rook-ceph-tools&quot; -o jsonpath=&#39;{.items[0].metadata.name}&#39;) -- rados&#39;</code></pre><pre><code>$ ceph status
  cluster:
    id:     cf4fa4d1-0d37-44bd-8cb1-53d7304b233c
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum a,b,c (age 7d)
    mgr: a(active, since 6d)
    osd: 3 osds: 3 up (since 7d), 3 in (since 7d)

  data:
    pools:   0 pools, 0 pgs
    objects: 0 objects, 0 B
    usage:   20 GiB used, 280 GiB / 300 GiB avail
    pgs:</code></pre><pre><code>$ ceph osd status
+----+----------------------+-------+-------+--------+---------+--------+---------+-----------+
| id |         host         |  used | avail | wr ops | wr data | rd ops | rd data |   state   |
+----+----------------------+-------+-------+--------+---------+--------+---------+-----------+
| 0  | datateam-rookceph-02 | 6885M | 93.2G |    0   |     0   |    0   |     0   | exists,up |
| 1  | datateam-rookceph-03 | 6882M | 93.2G |    0   |     0   |    0   |     0   | exists,up |
| 2  | datateam-rookceph-01 | 6968M | 93.1G |    0   |     0   |    0   |     0   | exists,up |
+----+----------------------+-------+-------+--------+---------+--------+---------+-----------+</code></pre><pre><code>$ ceph df
RAW STORAGE:
    CLASS     SIZE        AVAIL       USED       RAW USED     %RAW USED
    hdd       300 GiB     280 GiB     20 GiB       20 GiB          6.75
    TOTAL     300 GiB     280 GiB     20 GiB       20 GiB          6.75

POOLS:
    POOL     ID     STORED     OBJECTS     USED     %USED     MAX AVAIL</code></pre><pre><code>$ rados df
POOL_NAME USED OBJECTS CLONES COPIES MISSING_ON_PRIMARY UNFOUND DEGRADED RD_OPS RD WR_OPS WR USED COMPR UNDER COMPR

total_objects    0
total_used       20 GiB
total_avail      280 GiB
total_space      300 GiB</code></pre><h3 id="Use-Ceph-Dashboard"><a href="#Use-Ceph-Dashboard" class="headerlink" title="Use Ceph Dashboard"></a>Use Ceph Dashboard</h3><p>In the <a href="https://github.com/aruruka/laboratory/blob/master/k8s/manifest/apps/rook/cluster.yaml" target="_blank" rel="noopener"><code>cluster.yaml</code></a> manifest, we could found <code>.spec.dashboard</code> config, defaultly enabled.</p>
<p>Let’s find the Service name of defaultly deployed Ceph Dashboard.</p>
<p>First we could deploy a busybox container in whichever Namespace and use nslookup to find out the FQDN of any service.</p>
<p>As below, we can see the cluster domain is <code>datateam.local</code>.</p>
<pre><code>$ kubectl exec -ti busybox -- nslookup kubernetes
Server:         10.210.0.10
Address:        10.210.0.10#53

Name:   kubernetes.default.svc.datateam.local
Address: 10.210.0.1</code></pre><p>Then we find the service name of Ceph Dashboard.<br>As below, it’s <code>rook-ceph-mgr-dashboard</code>.</p>
<pre><code>$ kubectl get service -n rook-ceph
NAME                       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)             AGE
csi-cephfsplugin-metrics   ClusterIP   10.210.0.62    &lt;none&gt;        8080/TCP,8081/TCP   7d1h
csi-rbdplugin-metrics      ClusterIP   10.210.0.196   &lt;none&gt;        8080/TCP,8081/TCP   7d1h
rook-ceph-mgr              ClusterIP   10.210.0.118   &lt;none&gt;        9283/TCP            7d1h
rook-ceph-mgr-dashboard    ClusterIP   10.210.0.190   &lt;none&gt;        8443/TCP            7d1h
rook-ceph-mon-a            ClusterIP   10.210.0.48    &lt;none&gt;        6789/TCP,3300/TCP   7d1h
rook-ceph-mon-b            ClusterIP   10.210.0.223   &lt;none&gt;        6789/TCP,3300/TCP   7d1h
rook-ceph-mon-c            ClusterIP   10.210.0.149   &lt;none&gt;        6789/TCP,3300/TCP   7d1h</code></pre><p>So we can access Ceph Dashboard by this URL – <a href="https://rook-ceph-mgr-dashboard.rook-ceph.svc.datateam.local:8443" target="_blank" rel="noopener">https://rook-ceph-mgr-dashboard.rook-ceph.svc.datateam.local:8443</a>.</p>
<p>By default, Rook will create a Configmap to store the <code>admin</code> user’s password.</p>
<pre><code>$ kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath=&quot;{[&#39;data&#39;][&#39;password&#39;]}&quot; | base64 --decode &amp;&amp; echo
D17j9zPi3R</code></pre><p>Sample display as below.<br><img src="ceph_dashboard.png" alt="Ceph Dashboard"></p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://shouneng.website" rel="external nofollow noreferrer">少年G</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://shouneng.website/2020/03/18/about-rook-ceph/">https://shouneng.website/2020/03/18/about-rook-ceph/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://shouneng.website" target="_blank">少年G</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Ceph/">
                                    <span class="chip bg-color">Ceph</span>
                                </a>
                            
                                <a href="/tags/Kubernetes/">
                                    <span class="chip bg-color">Kubernetes</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">Buy me a coffe?</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'abe1f078df4c41c02917',
        clientSecret: '5cca9a3110ba22e0f959ea3aaf7ff2eeebd4e3e3',
        repo: 'aruruka.github.io',
        owner: 'aruruka',
        admin: "aruruka",
        id: '2020-03-18T22-31-15',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/03/23/ceph-performance-testing/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="Ceph Performance Testing">
                        
                        <span class="card-title">Ceph Performance Testing</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Rook Ceph performance testing. Contrast of EC block and Replicated block.
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-03-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Kubernetes/" class="post-category">
                                    Kubernetes
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Ceph/">
                        <span class="chip bg-color">Ceph</span>
                    </a>
                    
                    <a href="/tags/Kubernetes/">
                        <span class="chip bg-color">Kubernetes</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/01/19/calico-practicing-3-how-to-configure-accessing-calico-endpoint-from-outside-of-the-cluster/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/25.jpg" class="responsive-img" alt="Calico Practicing-3 -- How To Configure Accessing Calico Endpoint From Outside of The Cluster">
                        
                        <span class="card-title">Calico Practicing-3 -- How To Configure Accessing Calico Endpoint From Outside of The Cluster</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Our software technology stack is mainly Java with micro-service frameworks(e.g. Spring Boot, Consul).
And we're moving from VM to Kubernetes. Considering cases of putting consumer or/and registry conponents outside of the Kubernetes cluster, we have to make our network plane allows workload accessing Pod IP, Service IP from outside the Kubernetes cluster.
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-01-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Kubernetes/" class="post-category">
                                    Kubernetes
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Calico/">
                        <span class="chip bg-color">Calico</span>
                    </a>
                    
                    <a href="/tags/k8s/">
                        <span class="chip bg-color">k8s</span>
                    </a>
                    
                    <a href="/tags/SDN/">
                        <span class="chip bg-color">SDN</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 少年G的博客<br />'
            + '文章作者: 少年G<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="883064937"
                   fixed='true'
                   autoplay='false'
                   theme:='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://shouneng.website" target="_blank">少年G</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "08";
                    var startDate = "22";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/aruruka" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:keraymondyan69@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>



    <a href="https://www.facebook.com/aruruka" class="tooltipped" target="_blank" data-tooltip="关注我的Facebook: https://www.facebook.com/aruruka" data-position="top" data-delay="50">
        <i class="fab fa-facebook-f"></i>
    </a>



    <a href="https://twitter.com/aruruka" class="tooltipped" target="_blank" data-tooltip="关注我的Twitter: https://twitter.com/aruruka" data-position="top" data-delay="50">
        <i class="fab fa-twitter"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=273456339" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 273456339" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/keraymondyan69" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/keraymondyan69" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/shouneng" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/shouneng" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27145379-5"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-27145379-5');
</script>


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
